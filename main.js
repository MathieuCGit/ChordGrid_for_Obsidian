/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var __defProp = Object.defineProperty;
var __getOwnPropDesc = Object.getOwnPropertyDescriptor;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};
var __copyProps = (to, from, except, desc) => {
  if (from && typeof from === "object" || typeof from === "function") {
    for (let key of __getOwnPropNames(from))
      if (!__hasOwnProp.call(to, key) && key !== except)
        __defProp(to, key, { get: () => from[key], enumerable: !(desc = __getOwnPropDesc(from, key)) || desc.enumerable });
  }
  return to;
};
var __toCommonJS = (mod) => __copyProps(__defProp({}, "__esModule", { value: true }), mod);

// main.ts
var main_exports = {};
__export(main_exports, {
  default: () => ChordGridPlugin
});
module.exports = __toCommonJS(main_exports);
var import_obsidian = require("obsidian");
var ChordGridPlugin = class extends import_obsidian.Plugin {
  async onload() {
    console.log("Loading Chord Grid plugin");
    this.registerMarkdownCodeBlockProcessor("chordgrid", (source, el, ctx) => {
      this.renderChordGrid(source, el);
    });
  }
  /**
   * Parse chord grid text into structured data
   */
  parseChordGrid(source) {
    const lines = source.trim().split("\n");
    let timeSignature = "4/4";
    const measures = [];
    for (const line of lines) {
      const trimmed = line.trim();
      if (!trimmed)
        continue;
      if (measures.length === 0) {
        const timeSigMatch = trimmed.match(/^(\d+\/\d+)/);
        if (timeSigMatch) {
          timeSignature = timeSigMatch[1];
        }
      }
      const tokens = this.tokenizeLine(trimmed);
      let currentMeasure = { chords: [], hasBarLine: false };
      let isRepeatStart = false;
      let isRepeatEnd = false;
      for (const token of tokens) {
        if (token.type === "repeatStart") {
          isRepeatStart = true;
        } else if (token.type === "repeatEnd") {
          isRepeatEnd = true;
        } else if (token.type === "barLine") {
          if (currentMeasure.chords.length > 0) {
            currentMeasure.hasBarLine = true;
            currentMeasure.isRepeatEnd = isRepeatEnd;
            measures.push(currentMeasure);
            currentMeasure = {
              chords: [],
              hasBarLine: false,
              isRepeatStart: false
            };
            isRepeatEnd = false;
          }
        } else if (token.type === "chord") {
          currentMeasure.chords.push({
            chord: token.chord,
            beats: token.beats
          });
        }
      }
      if (currentMeasure.chords.length > 0) {
        currentMeasure.isRepeatEnd = isRepeatEnd;
        measures.push(currentMeasure);
      }
      if (measures.length > 0 && isRepeatStart) {
        measures[0].isRepeatStart = true;
      }
      if (lines.length > 1 && line !== lines[lines.length - 1]) {
        measures.push({ chords: [], hasBarLine: false, isLineBreak: true });
      }
    }
    return { timeSignature, measures };
  }
  /**
   * Tokenize a line into meaningful tokens
   *
   * Changes: rhythm tokens now parse per-note dotted flags.
   * A token may be like:
   *  - "4" => quarter
   *  - "4." => dotted quarter
   *  - "3232161616" => sequence of small notes (32 32 16 16 16 ...)
   *  - "8.16" or "8. 16" => dotted eighth + sixteenth (we support both forms)
   */
  tokenizeLine(line) {
    const tokens = [];
    let remaining = line.replace(/^\d+\/\d+\s*/, "");
    while (remaining.length > 0) {
      remaining = remaining.trim();
      if (remaining.startsWith("||:")) {
        tokens.push({ type: "repeatStart" });
        remaining = remaining.substring(3);
        continue;
      } else if (remaining.startsWith("|:")) {
        tokens.push({ type: "repeatStart" });
        remaining = remaining.substring(2);
        continue;
      } else if (remaining.startsWith(":||")) {
        tokens.push({ type: "repeatEnd" });
        remaining = remaining.substring(3);
        continue;
      }
      if (remaining.startsWith("||")) {
        tokens.push({ type: "barLine" });
        remaining = remaining.substring(2);
        continue;
      } else if (remaining.startsWith("|")) {
        tokens.push({ type: "barLine" });
        remaining = remaining.substring(1);
        continue;
      }
      const chordMatch = remaining.match(/^([A-G][#b]?(?:maj|min|m|dim|aug|sus|[0-9])*)\[([0-9.\s]+)\]/);
      if (chordMatch) {
        const chord = chordMatch[1];
        const rhythm = chordMatch[2];
        const beats = [];
        const rhythmTokens = rhythm.split(/\s+/).filter((r) => r.length > 0);
        for (const token of rhythmTokens) {
          const notes = [];
          let i = 0;
          while (i < token.length) {
            const ch = token[i];
            const next = (offset = 1) => token[i + offset] || "";
            if (ch === "3" && next(1) === "2") {
              let dotted = false;
              if (token[i + 2] === ".") {
                dotted = true;
              }
              notes.push({ value: 32, dotted });
              i += 2;
              if (token[i] === ".")
                i += 1;
            } else if (ch === "1" && next(1) === "6") {
              let dotted = false;
              if (token[i + 2] === ".")
                dotted = true;
              notes.push({ value: 16, dotted });
              i += 2;
              if (token[i] === ".")
                i += 1;
            } else if (ch === "8" || ch === "4" || ch === "2" || ch === "1") {
              let dotted = false;
              if (token[i + 1] === ".")
                dotted = true;
              const val = parseInt(ch, 10);
              notes.push({ value: val, dotted });
              i += 1;
              if (token[i] === ".")
                i += 1;
            } else {
              i += 1;
            }
          }
          if (notes.length > 0) {
            beats.push({ notes });
          }
        }
        tokens.push({ type: "chord", chord, beats });
        remaining = remaining.substring(chordMatch[0].length);
        continue;
      }
      remaining = remaining.substring(1);
    }
    return tokens;
  }
  /**
   * Render chord grid from source text into container element
   */
  renderChordGrid(source, container) {
    const grid = this.parseChordGrid(source);
    const svg = this.createSVG(grid);
    container.empty();
    container.appendChild(svg);
  }
  /**
   * Create SVG element for the entire chord grid
   */
  createSVG(grid) {
    const measuresPerLine = 4;
    const measureWidth = 200;
    const measureHeight = 120;
    let currentLine = 0;
    let measuresInCurrentLine = 0;
    const measurePositions = [];
    grid.measures.forEach((measure, index) => {
      if (measure.isLineBreak) {
        currentLine++;
        measuresInCurrentLine = 0;
        return;
      }
      if (measuresInCurrentLine >= measuresPerLine) {
        currentLine++;
        measuresInCurrentLine = 0;
      }
      measurePositions.push({
        measure,
        lineIndex: currentLine,
        posInLine: measuresInCurrentLine
      });
      measuresInCurrentLine++;
    });
    const lines = currentLine + 1;
    const width = measuresPerLine * measureWidth + 60;
    const height = lines * (measureHeight + 20) + 20;
    const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
    svg.setAttribute("width", width.toString());
    svg.setAttribute("height", height.toString());
    svg.setAttribute("viewBox", `0 0 ${width} ${height}`);
    svg.style.background = "#ffffff";
    const timeSigText = this.createText(grid.timeSignature, 10, 40, "18px", "bold");
    svg.appendChild(timeSigText);
    measurePositions.forEach(({ measure, lineIndex, posInLine }) => {
      const x = posInLine * measureWidth + 40;
      const y = lineIndex * (measureHeight + 20) + 20;
      this.drawMeasure(svg, measure, x, y, measureWidth, measureHeight);
    });
    return svg;
  }
  /**
   * Draw a single measure with chord, rhythm, and bar lines
   */
  drawMeasure(svg, measure, x, y, width, height) {
    if (measure.isRepeatStart) {
      this.drawRepeatBar(svg, x, y, height, true);
    } else {
      this.drawBar(svg, x, y, height);
    }
    const staffLineY = y + 80;
    const staffLine = document.createElementNS("http://www.w3.org/2000/svg", "line");
    staffLine.setAttribute("x1", (x + 10).toString());
    staffLine.setAttribute("y1", staffLineY.toString());
    staffLine.setAttribute("x2", (x + width - 10).toString());
    staffLine.setAttribute("y2", staffLineY.toString());
    staffLine.setAttribute("stroke", "#000");
    staffLine.setAttribute("stroke-width", "1");
    svg.appendChild(staffLine);
    const chordWidth = width / measure.chords.length;
    measure.chords.forEach((chordData, chordIndex) => {
      const chordX = x + chordIndex * chordWidth + 10;
      const firstNoteX = this.drawRhythm(svg, chordData, chordX, staffLineY, chordWidth - 20);
      if (firstNoteX !== null) {
        const chordText = this.createText(chordData.chord, firstNoteX, y + 40, "24px", "bold");
        chordText.setAttribute("text-anchor", "middle");
        svg.appendChild(chordText);
      }
    });
    const rightBarX = x + width - 2;
    if (measure.hasBarLine || measure.isRepeatEnd) {
      if (measure.isRepeatEnd) {
        this.drawRepeatBar(svg, rightBarX, y, height, false);
      } else {
        this.drawBar(svg, rightBarX, y, height);
      }
    }
  }
  /**
   * Draw a simple bar line
   */
  drawBar(svg, x, y, height) {
    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.setAttribute("x1", x.toString());
    line.setAttribute("y1", y.toString());
    line.setAttribute("x2", x.toString());
    line.setAttribute("y2", (y + height).toString());
    line.setAttribute("stroke", "#000");
    line.setAttribute("stroke-width", "2");
    svg.appendChild(line);
  }
  /**
   * Draw repeat bar with dots
   */
  drawRepeatBar(svg, x, y, height, isStart) {
    const offset = isStart ? 0 : -6;
    const barX = x + offset;
    this.drawBar(svg, barX, y, height);
    this.drawBar(svg, barX + 4, y, height);
    const dotOffset = isStart ? 10 : -10;
    const dot1Y = y + height * 0.35;
    const dot2Y = y + height * 0.65;
    [dot1Y, dot2Y].forEach((dotY) => {
      const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      circle.setAttribute("cx", (x + dotOffset).toString());
      circle.setAttribute("cy", dotY.toString());
      circle.setAttribute("r", "3");
      circle.setAttribute("fill", "#000");
      svg.appendChild(circle);
    });
  }
  /**
   * Draw rhythm pattern for a chord and return the x position of the first note
   */
  drawRhythm(svg, chordData, x, staffLineY, width) {
    const beats = chordData.beats;
    const beatWidth = beats.length > 0 ? width / beats.length : width;
    let currentX = x;
    let firstNoteX = null;
    beats.forEach((beat, beatIndex) => {
      const firstNoteInBeatX = this.drawBeat(svg, beat, currentX, staffLineY, beatWidth);
      if (beatIndex === 0 && firstNoteInBeatX !== null) {
        firstNoteX = firstNoteInBeatX;
      }
      currentX += beatWidth;
    });
    return firstNoteX;
  }
  /**
   * Draw a single beat - handles both single notes and beamed groups
   * Returns the x position of the first note in this beat
   */
  drawBeat(svg, beat, x, staffLineY, width) {
    if (beat.notes.length === 1) {
      const nv = beat.notes[0];
      return this.drawSingleNote(svg, nv, x, staffLineY, width);
    } else {
      return this.drawNoteGroup(svg, beat.notes, x, staffLineY, width);
    }
  }
  /**
   * Draw a single note with slash and stem
   */
  drawSingleNote(svg, nv, x, staffLineY, width) {
    const centerX = x + width / 2;
    this.drawSlash(svg, centerX, staffLineY);
    if (nv.value >= 2 && nv.value !== 1) {
      this.drawStem(svg, centerX, staffLineY, 25);
    }
    if (nv.value === 8) {
      this.drawFlag(svg, centerX, staffLineY, 1);
    } else if (nv.value === 16) {
      this.drawFlag(svg, centerX, staffLineY, 2);
    } else if (nv.value === 32) {
      this.drawFlag(svg, centerX, staffLineY, 3);
    }
    if (nv.dotted) {
      const dot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
      dot.setAttribute("cx", (centerX + 8).toString());
      dot.setAttribute("cy", staffLineY.toString());
      dot.setAttribute("r", "2");
      dot.setAttribute("fill", "#000");
      svg.appendChild(dot);
    }
    return centerX;
  }
  /**
   * Draw a group of notes with proper beaming, including nested beam segments for mixed durations
   * notesValues: array of NoteValue objects (e.g., [{value:8},{value:16}])
   *
   * Behavior:
   * - Compute beamCount per note (8->1,16->2,32->3).
   * - Draw stem for each note and store stem positions.
   * - For each beam level, draw continuous beams where notes have beamCount >= level.
   * - For notes that have extra beams (level > neighbor's level), draw a short stub extending left from that stem.
   * - Draw per-note dotted points next to heads.
   */
  drawNoteGroup(svg, notesValues, x, staffLineY, width) {
    const noteCount = notesValues.length;
    const noteSpacing = noteCount > 0 ? width / noteCount : width;
    const stemHeight = 25;
    const notes = [];
    for (let i = 0; i < noteCount; i++) {
      const nv = notesValues[i];
      const centerX = x + i * noteSpacing + noteSpacing / 2;
      const beamCount = nv.value === 8 ? 1 : nv.value === 16 ? 2 : nv.value === 32 ? 3 : 0;
      this.drawSlash(svg, centerX, staffLineY);
      const stemInfo = this.drawStem(svg, centerX, staffLineY, stemHeight);
      notes.push({ nv, beamCount, centerX, stemX: stemInfo.x, stemTopY: stemInfo.topY, stemBottomY: stemInfo.bottomY });
      if (nv.dotted) {
        const dot = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        dot.setAttribute("cx", (centerX + 8).toString());
        dot.setAttribute("cy", staffLineY.toString());
        dot.setAttribute("r", "2");
        dot.setAttribute("fill", "#000");
        svg.appendChild(dot);
      }
    }
    const maxBeamCount = notes.reduce((m, n) => Math.max(m, n.beamCount), 0);
    if (maxBeamCount === 0)
      return notes.length ? notes[0].centerX : null;
    const beamGap = 5;
    const validStemBottoms = notes.map((n) => n.stemBottomY).filter((y) => y !== void 0);
    const baseStemBottom = validStemBottoms.length > 0 ? Math.min(...validStemBottoms) : staffLineY + 30;
    for (let level = 1; level <= maxBeamCount; level++) {
      let segStartIndex = null;
      for (let i = 0; i < notes.length; i++) {
        const n = notes[i];
        const active = n.beamCount >= level;
        if (active && segStartIndex === null) {
          segStartIndex = i;
        } else if ((!active || i === notes.length - 1) && segStartIndex !== null) {
          const segEnd = active && i === notes.length - 1 ? i : i - 1;
          const beamY = baseStemBottom - (level - 1) * beamGap;
          const startX = notes[segStartIndex].stemX;
          const endX = notes[segEnd].stemX;
          const beam = document.createElementNS("http://www.w3.org/2000/svg", "line");
          beam.setAttribute("x1", startX.toString());
          beam.setAttribute("y1", beamY.toString());
          beam.setAttribute("x2", endX.toString());
          beam.setAttribute("y2", beamY.toString());
          beam.setAttribute("stroke", "#000");
          beam.setAttribute("stroke-width", "2");
          svg.appendChild(beam);
          segStartIndex = null;
        }
      }
      const stubLength = Math.max(8, noteSpacing * 0.4);
      for (let i = 0; i < notes.length; i++) {
        const n = notes[i];
        const hasLevel = n.beamCount >= level;
        if (!hasLevel)
          continue;
        const leftBeamCount = i - 1 >= 0 ? notes[i - 1].beamCount : 0;
        const rightBeamCount = i + 1 < notes.length ? notes[i + 1].beamCount : 0;
        const leftHasLevel = leftBeamCount >= level;
        const rightHasLevel = rightBeamCount >= level;
        if (leftHasLevel && rightHasLevel)
          continue;
        if (!leftHasLevel && !rightHasLevel) {
          if (i < notes.length - 1) {
            const beamY2 = baseStemBottom - (level - 1) * beamGap;
            const stemX2 = n.stemX;
            const stubX = stemX2 + stubLength;
            const beam = document.createElementNS("http://www.w3.org/2000/svg", "line");
            beam.setAttribute("x1", stemX2.toString());
            beam.setAttribute("y1", beamY2.toString());
            beam.setAttribute("x2", stubX.toString());
            beam.setAttribute("y2", beamY2.toString());
            beam.setAttribute("stroke", "#000");
            beam.setAttribute("stroke-width", "2");
            svg.appendChild(beam);
          } else if (i > 0) {
            const beamY2 = baseStemBottom - (level - 1) * beamGap;
            const stemX2 = n.stemX;
            const stubX = stemX2 - stubLength;
            const beam = document.createElementNS("http://www.w3.org/2000/svg", "line");
            beam.setAttribute("x1", stemX2.toString());
            beam.setAttribute("y1", beamY2.toString());
            beam.setAttribute("x2", stubX.toString());
            beam.setAttribute("y2", beamY2.toString());
            beam.setAttribute("stroke", "#000");
            beam.setAttribute("stroke-width", "2");
            svg.appendChild(beam);
          }
          continue;
        }
        const beamY = baseStemBottom - (level - 1) * beamGap;
        const stemX = n.stemX;
        if (leftHasLevel && !rightHasLevel && i > 0) {
          const stubX = stemX - stubLength;
          const beam = document.createElementNS("http://www.w3.org/2000/svg", "line");
          beam.setAttribute("x1", stemX.toString());
          beam.setAttribute("y1", beamY.toString());
          beam.setAttribute("x2", stubX.toString());
          beam.setAttribute("y2", beamY.toString());
          beam.setAttribute("stroke", "#000");
          beam.setAttribute("stroke-width", "2");
          svg.appendChild(beam);
        }
        if (!leftHasLevel && rightHasLevel && i < notes.length - 1) {
          const stubX = stemX + stubLength;
          const beam = document.createElementNS("http://www.w3.org/2000/svg", "line");
          beam.setAttribute("x1", stemX.toString());
          beam.setAttribute("y1", beamY.toString());
          beam.setAttribute("x2", stubX.toString());
          beam.setAttribute("y2", beamY.toString());
          beam.setAttribute("stroke", "#000");
          beam.setAttribute("stroke-width", "2");
          svg.appendChild(beam);
        }
      }
    }
    return notes.length ? notes[0].centerX : null;
  }
  /**
   * Draw a slash at 45Â° angle (top-RIGHT to bottom-LEFT - proper slash direction)
   * with stem attached to the bottom
   */
  drawSlash(svg, x, y) {
    const slashLength = 10;
    const slash = document.createElementNS("http://www.w3.org/2000/svg", "line");
    slash.setAttribute("x1", (x + slashLength / 2).toString());
    slash.setAttribute("y1", (y - slashLength / 2).toString());
    slash.setAttribute("x2", (x - slashLength / 2).toString());
    slash.setAttribute("y2", (y + slashLength / 2).toString());
    slash.setAttribute("stroke", "#000");
    slash.setAttribute("stroke-width", "3");
    svg.appendChild(slash);
  }
  /**
   * Draw a stem for a note - ATTACHED TO BOTTOM OF SLASH
   * Returns the X position of the stem and the bottom Y for proper beam alignment
   */
  drawStem(svg, x, y, height) {
    const slashLength = 10;
    const stemStartX = x - slashLength / 2 + 2;
    const stemStartY = y + slashLength / 2;
    const stem = document.createElementNS("http://www.w3.org/2000/svg", "line");
    stem.setAttribute("x1", stemStartX.toString());
    stem.setAttribute("y1", stemStartY.toString());
    stem.setAttribute("x2", stemStartX.toString());
    stem.setAttribute("y2", (stemStartY + height).toString());
    stem.setAttribute("stroke", "#000");
    stem.setAttribute("stroke-width", "2");
    svg.appendChild(stem);
    return { x: stemStartX, topY: stemStartY, bottomY: stemStartY + height };
  }
  /**
   * Draw flag(s) for a note (for isolated short notes)
   */
  drawFlag(svg, x, staffLineY, count) {
    const slashLength = 10;
    const stemStartX = x - slashLength / 2 + 2;
    const stemBottomY = staffLineY + slashLength / 2 + 25;
    for (let i = 0; i < count; i++) {
      const flag = document.createElementNS("http://www.w3.org/2000/svg", "path");
      const flagY = stemBottomY - i * 10;
      flag.setAttribute("d", `M ${stemStartX} ${flagY} Q ${stemStartX - 10} ${flagY - 5} ${stemStartX - 8} ${flagY - 12}`);
      flag.setAttribute("stroke", "#000");
      flag.setAttribute("stroke-width", "2");
      flag.setAttribute("fill", "none");
      svg.appendChild(flag);
    }
  }
  /**
   * Utility function to create text elements
   */
  createText(text, x, y, size, weight = "normal") {
    const textEl = document.createElementNS("http://www.w3.org/2000/svg", "text");
    textEl.setAttribute("x", x.toString());
    textEl.setAttribute("y", y.toString());
    textEl.setAttribute("font-family", "Arial, sans-serif");
    textEl.setAttribute("font-size", size);
    textEl.setAttribute("font-weight", weight);
    textEl.setAttribute("fill", "#000");
    textEl.textContent = text;
    return textEl;
  }
  onunload() {
    console.log("Unloading Chord Grid plugin");
  }
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibWFpbi50cyJdLAogICJzb3VyY2VzQ29udGVudCI6IFsiaW1wb3J0IHsgUGx1Z2luLCBNYXJrZG93blBvc3RQcm9jZXNzb3JDb250ZXh0IH0gZnJvbSAnb2JzaWRpYW4nO1xuXG4vLyBJbnRlcmZhY2UgZGVmaW5pdGlvbnMgZm9yIG91ciBkYXRhIHN0cnVjdHVyZXNcbmludGVyZmFjZSBOb3RlVmFsdWUge1xuICB2YWx1ZTogbnVtYmVyOyAgICAgICAgLy8gMSwyLDQsOCwxNiwzMi4uLlxuICBkb3R0ZWQ/OiBib29sZWFuOyAgICAgLy8gd2hldGhlciB0aGlzIHNwZWNpZmljIG5vdGUgaXMgZG90dGVkXG59XG5cbmludGVyZmFjZSBCZWF0IHtcbiAgbm90ZXM6IE5vdGVWYWx1ZVtdOyAvLyBMaXN0IG9mIHJoeXRobWljIHZhbHVlcyAoOCwgNCwgMiwgMSwgZXRjLikgd2l0aCBvcHRpb25hbCBkb3R0ZWQgZmxhZ1xufVxuXG5pbnRlcmZhY2UgQ2hvcmRJbk1lYXN1cmUge1xuICBjaG9yZDogc3RyaW5nO1xuICBiZWF0czogQmVhdFtdO1xufVxuXG5pbnRlcmZhY2UgTWVhc3VyZSB7XG4gIGNob3JkczogQ2hvcmRJbk1lYXN1cmVbXTtcbiAgaXNSZXBlYXRTdGFydD86IGJvb2xlYW47XG4gIGlzUmVwZWF0RW5kPzogYm9vbGVhbjtcbiAgaGFzQmFyTGluZT86IGJvb2xlYW47XG4gIGlzTGluZUJyZWFrPzogYm9vbGVhbjtcbn1cblxuaW50ZXJmYWNlIENob3JkR3JpZCB7XG4gIHRpbWVTaWduYXR1cmU6IHN0cmluZztcbiAgbWVhc3VyZXM6IE1lYXN1cmVbXTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2hvcmRHcmlkUGx1Z2luIGV4dGVuZHMgUGx1Z2luIHtcbiAgYXN5bmMgb25sb2FkKCkge1xuICAgIGNvbnNvbGUubG9nKCdMb2FkaW5nIENob3JkIEdyaWQgcGx1Z2luJyk7XG5cbiAgICAvLyBSZWdpc3RlciBtYXJrZG93biBjb2RlIGJsb2NrIHByb2Nlc3NvciBmb3IgJ2Nob3JkZ3JpZCcgYmxvY2tzXG4gICAgdGhpcy5yZWdpc3Rlck1hcmtkb3duQ29kZUJsb2NrUHJvY2Vzc29yKCdjaG9yZGdyaWQnLCAoc291cmNlLCBlbCwgY3R4KSA9PiB7XG4gICAgICB0aGlzLnJlbmRlckNob3JkR3JpZChzb3VyY2UsIGVsKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQYXJzZSBjaG9yZCBncmlkIHRleHQgaW50byBzdHJ1Y3R1cmVkIGRhdGFcbiAgICovXG4gIHBhcnNlQ2hvcmRHcmlkKHNvdXJjZTogc3RyaW5nKTogQ2hvcmRHcmlkIHtcbiAgICBjb25zdCBsaW5lcyA9IHNvdXJjZS50cmltKCkuc3BsaXQoJ1xcbicpO1xuICAgIGxldCB0aW1lU2lnbmF0dXJlID0gJzQvNCc7XG4gICAgY29uc3QgbWVhc3VyZXM6IE1lYXN1cmVbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICBjb25zdCB0cmltbWVkID0gbGluZS50cmltKCk7XG4gICAgICBpZiAoIXRyaW1tZWQpIGNvbnRpbnVlO1xuXG4gICAgICAvLyBQYXJzZSB0aW1lIHNpZ25hdHVyZSAob25seSBmcm9tIGZpcnN0IGxpbmUpXG4gICAgICBpZiAobWVhc3VyZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnN0IHRpbWVTaWdNYXRjaCA9IHRyaW1tZWQubWF0Y2goL14oXFxkK1xcL1xcZCspLyk7XG4gICAgICAgIGlmICh0aW1lU2lnTWF0Y2gpIHtcbiAgICAgICAgICB0aW1lU2lnbmF0dXJlID0gdGltZVNpZ01hdGNoWzFdO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFBhcnNlIGNob3JkcyBpbnRvIG1lYXN1cmVzIGJhc2VkIG9uIGJhciBsaW5lc1xuICAgICAgY29uc3QgdG9rZW5zID0gdGhpcy50b2tlbml6ZUxpbmUodHJpbW1lZCk7XG4gICAgICBsZXQgY3VycmVudE1lYXN1cmU6IE1lYXN1cmUgPSB7IGNob3JkczogW10sIGhhc0JhckxpbmU6IGZhbHNlIH07XG4gICAgICBsZXQgaXNSZXBlYXRTdGFydCA9IGZhbHNlO1xuICAgICAgbGV0IGlzUmVwZWF0RW5kID0gZmFsc2U7XG5cbiAgICAgIGZvciAoY29uc3QgdG9rZW4gb2YgdG9rZW5zKSB7XG4gICAgICAgIGlmICh0b2tlbi50eXBlID09PSAncmVwZWF0U3RhcnQnKSB7XG4gICAgICAgICAgaXNSZXBlYXRTdGFydCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAodG9rZW4udHlwZSA9PT0gJ3JlcGVhdEVuZCcpIHtcbiAgICAgICAgICBpc1JlcGVhdEVuZCA9IHRydWU7XG4gICAgICAgIH0gZWxzZSBpZiAodG9rZW4udHlwZSA9PT0gJ2JhckxpbmUnKSB7XG4gICAgICAgICAgLy8gQmFyIGxpbmUgbWVhbnMgd2UgZmluYWxpemUgdGhlIGN1cnJlbnQgbWVhc3VyZSBhbmQgc3RhcnQgYSBuZXcgb25lXG4gICAgICAgICAgaWYgKGN1cnJlbnRNZWFzdXJlLmNob3Jkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjdXJyZW50TWVhc3VyZS5oYXNCYXJMaW5lID0gdHJ1ZTtcbiAgICAgICAgICAgIGN1cnJlbnRNZWFzdXJlLmlzUmVwZWF0RW5kID0gaXNSZXBlYXRFbmQ7XG4gICAgICAgICAgICBtZWFzdXJlcy5wdXNoKGN1cnJlbnRNZWFzdXJlKTtcbiAgICAgICAgICAgIC8vIFN0YXJ0IGEgbmV3IG1lYXN1cmVcbiAgICAgICAgICAgIGN1cnJlbnRNZWFzdXJlID0geyBcbiAgICAgICAgICAgICAgY2hvcmRzOiBbXSwgXG4gICAgICAgICAgICAgIGhhc0JhckxpbmU6IGZhbHNlLFxuICAgICAgICAgICAgICBpc1JlcGVhdFN0YXJ0OiBmYWxzZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlzUmVwZWF0RW5kID0gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRva2VuLnR5cGUgPT09ICdjaG9yZCcpIHtcbiAgICAgICAgICAvLyBBZGQgY2hvcmQgdG8gY3VycmVudCBtZWFzdXJlXG4gICAgICAgICAgY3VycmVudE1lYXN1cmUuY2hvcmRzLnB1c2goe1xuICAgICAgICAgICAgY2hvcmQ6IHRva2VuLmNob3JkISxcbiAgICAgICAgICAgIGJlYXRzOiB0b2tlbi5iZWF0cyFcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBEb24ndCBmb3JnZXQgdGhlIGxhc3QgbWVhc3VyZVxuICAgICAgaWYgKGN1cnJlbnRNZWFzdXJlLmNob3Jkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGN1cnJlbnRNZWFzdXJlLmlzUmVwZWF0RW5kID0gaXNSZXBlYXRFbmQ7XG4gICAgICAgIG1lYXN1cmVzLnB1c2goY3VycmVudE1lYXN1cmUpO1xuICAgICAgfVxuXG4gICAgICAvLyBBcHBseSByZXBlYXQgc3RhcnQgdG8gdGhlIEZJUlNUIG1lYXN1cmUgaWYgd2UgaGF2ZSBvbmVcbiAgICAgIGlmIChtZWFzdXJlcy5sZW5ndGggPiAwICYmIGlzUmVwZWF0U3RhcnQpIHtcbiAgICAgICAgbWVhc3VyZXNbMF0uaXNSZXBlYXRTdGFydCA9IHRydWU7XG4gICAgICB9XG5cbiAgICAgIC8vIEFkZCBsaW5lIGJyZWFrIG1hcmtlciBpZiB0aGVyZSBhcmUgbW9yZSBsaW5lc1xuICAgICAgaWYgKGxpbmVzLmxlbmd0aCA+IDEgJiYgbGluZSAhPT0gbGluZXNbbGluZXMubGVuZ3RoIC0gMV0pIHtcbiAgICAgICAgbWVhc3VyZXMucHVzaCh7IGNob3JkczogW10sIGhhc0JhckxpbmU6IGZhbHNlLCBpc0xpbmVCcmVhazogdHJ1ZSB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4geyB0aW1lU2lnbmF0dXJlLCBtZWFzdXJlcyB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFRva2VuaXplIGEgbGluZSBpbnRvIG1lYW5pbmdmdWwgdG9rZW5zXG4gICAqXG4gICAqIENoYW5nZXM6IHJoeXRobSB0b2tlbnMgbm93IHBhcnNlIHBlci1ub3RlIGRvdHRlZCBmbGFncy5cbiAgICogQSB0b2tlbiBtYXkgYmUgbGlrZTpcbiAgICogIC0gXCI0XCIgPT4gcXVhcnRlclxuICAgKiAgLSBcIjQuXCIgPT4gZG90dGVkIHF1YXJ0ZXJcbiAgICogIC0gXCIzMjMyMTYxNjE2XCIgPT4gc2VxdWVuY2Ugb2Ygc21hbGwgbm90ZXMgKDMyIDMyIDE2IDE2IDE2IC4uLilcbiAgICogIC0gXCI4LjE2XCIgb3IgXCI4LiAxNlwiID0+IGRvdHRlZCBlaWdodGggKyBzaXh0ZWVudGggKHdlIHN1cHBvcnQgYm90aCBmb3JtcylcbiAgICovXG4gIHRva2VuaXplTGluZShsaW5lOiBzdHJpbmcpOiBBcnJheTx7dHlwZTogc3RyaW5nLCBjaG9yZD86IHN0cmluZywgYmVhdHM/OiBCZWF0W119PiB7XG4gICAgY29uc3QgdG9rZW5zOiBBcnJheTx7dHlwZTogc3RyaW5nLCBjaG9yZD86IHN0cmluZywgYmVhdHM/OiBCZWF0W119PiA9IFtdO1xuICAgIGxldCByZW1haW5pbmcgPSBsaW5lLnJlcGxhY2UoL15cXGQrXFwvXFxkK1xccyovLCAnJyk7IC8vIFJlbW92ZSB0aW1lIHNpZ25hdHVyZVxuICAgIFxuICAgIHdoaWxlIChyZW1haW5pbmcubGVuZ3RoID4gMCkge1xuICAgICAgcmVtYWluaW5nID0gcmVtYWluaW5nLnRyaW0oKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIHJlcGVhdCBtYXJrZXJzXG4gICAgICBpZiAocmVtYWluaW5nLnN0YXJ0c1dpdGgoJ3x8OicpKSB7XG4gICAgICAgIHRva2Vucy5wdXNoKHsgdHlwZTogJ3JlcGVhdFN0YXJ0JyB9KTtcbiAgICAgICAgcmVtYWluaW5nID0gcmVtYWluaW5nLnN1YnN0cmluZygzKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2UgaWYgKHJlbWFpbmluZy5zdGFydHNXaXRoKCd8OicpKSB7XG4gICAgICAgIHRva2Vucy5wdXNoKHsgdHlwZTogJ3JlcGVhdFN0YXJ0JyB9KTtcbiAgICAgICAgcmVtYWluaW5nID0gcmVtYWluaW5nLnN1YnN0cmluZygyKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9IGVsc2UgaWYgKHJlbWFpbmluZy5zdGFydHNXaXRoKCc6fHwnKSkge1xuICAgICAgICB0b2tlbnMucHVzaCh7IHR5cGU6ICdyZXBlYXRFbmQnIH0pO1xuICAgICAgICByZW1haW5pbmcgPSByZW1haW5pbmcuc3Vic3RyaW5nKDMpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIGJhciBsaW5lc1xuICAgICAgaWYgKHJlbWFpbmluZy5zdGFydHNXaXRoKCd8fCcpKSB7XG4gICAgICAgIHRva2Vucy5wdXNoKHsgdHlwZTogJ2JhckxpbmUnIH0pO1xuICAgICAgICByZW1haW5pbmcgPSByZW1haW5pbmcuc3Vic3RyaW5nKDIpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH0gZWxzZSBpZiAocmVtYWluaW5nLnN0YXJ0c1dpdGgoJ3wnKSkge1xuICAgICAgICB0b2tlbnMucHVzaCh7IHR5cGU6ICdiYXJMaW5lJyB9KTtcbiAgICAgICAgcmVtYWluaW5nID0gcmVtYWluaW5nLnN1YnN0cmluZygxKTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGZvciBjaG9yZHMgLSBhbGxvdyBkb3RzIGluIHJoeXRobSB0b2tlbnMgKGUuZy4sIDQuIGZvciBkb3R0ZWQgcXVhcnRlcilcbiAgICAgIGNvbnN0IGNob3JkTWF0Y2ggPSByZW1haW5pbmcubWF0Y2goL14oW0EtR11bI2JdPyg/Om1hanxtaW58bXxkaW18YXVnfHN1c3xbMC05XSkqKVxcWyhbMC05Llxcc10rKVxcXS8pO1xuICAgICAgaWYgKGNob3JkTWF0Y2gpIHtcbiAgICAgICAgY29uc3QgY2hvcmQgPSBjaG9yZE1hdGNoWzFdO1xuICAgICAgICBjb25zdCByaHl0aG0gPSBjaG9yZE1hdGNoWzJdO1xuICAgICAgICBcbiAgICAgICAgLy8gUGFyc2Ugcmh5dGhtIGludG8gYmVhdHNcbiAgICAgICAgY29uc3QgYmVhdHM6IEJlYXRbXSA9IFtdO1xuICAgICAgICAvLyBzcGxpdCB0b2tlbnMgb24gc3BhY2VzOyBlYWNoIHRva2VuIG1heSBpdHNlbGYgY29udGFpbiBtdWx0aXBsZSBudW1lcmljIGVsZW1lbnRzXG4gICAgICAgIGNvbnN0IHJoeXRobVRva2VucyA9IHJoeXRobS5zcGxpdCgvXFxzKy8pLmZpbHRlcihyID0+IHIubGVuZ3RoID4gMCk7XG4gICAgICAgIFxuICAgICAgICBmb3IgKGNvbnN0IHRva2VuIG9mIHJoeXRobVRva2Vucykge1xuICAgICAgICAgIC8vIFdlIHdpbGwgcGFyc2UgdGhlIHRva2VuIGNoYXJhY3RlciBieSBjaGFyYWN0ZXIsIGFsbG93aW5nIGZvciBwYXR0ZXJucyBsaWtlOlxuICAgICAgICAgIC8vIFwiOC5cIiwgXCIxNlwiLCBcIjMyMzJcIiwgXCI4LjE2XCIsIGV0Yy5cbiAgICAgICAgICBjb25zdCBub3RlczogTm90ZVZhbHVlW10gPSBbXTtcbiAgICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgICAgd2hpbGUgKGkgPCB0b2tlbi5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IGNoID0gdG9rZW5baV07XG4gICAgICAgICAgICAvLyBIZWxwZXIgdG8gY2hlY2sgYWhlYWQgc2FmZWx5XG4gICAgICAgICAgICBjb25zdCBuZXh0ID0gKG9mZnNldCA9IDEpID0+IHRva2VuW2kgKyBvZmZzZXRdIHx8ICcnO1xuICAgICAgICAgICAgLy8gcGFyc2UgMzJcbiAgICAgICAgICAgIGlmIChjaCA9PT0gJzMnICYmIG5leHQoMSkgPT09ICcyJykge1xuICAgICAgICAgICAgICAvLyBjaGVjayBmb3IgZG90IGltbWVkaWF0ZWx5IGFmdGVyICczMicgKGxpa2UgXCIzMi5cIilcbiAgICAgICAgICAgICAgbGV0IGRvdHRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICBpZiAodG9rZW5baSsyXSA9PT0gJy4nKSB7XG4gICAgICAgICAgICAgICAgZG90dGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAvLyBjb25zdW1lIGRvdCBieSBpbmNyZW1lbnRpbmcgZXh0cmEgbGF0ZXJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBub3Rlcy5wdXNoKHsgdmFsdWU6IDMyLCBkb3R0ZWQgfSk7XG4gICAgICAgICAgICAgIC8vIGFkdmFuY2UgaSBieSAyIChmb3IgJzMyJylcbiAgICAgICAgICAgICAgaSArPSAyO1xuICAgICAgICAgICAgICAvLyBpZiB0aGVyZSB3YXMgYSBkb3QsIHNraXAgaXRcbiAgICAgICAgICAgICAgaWYgKHRva2VuW2ldID09PSAnLicpIGkgKz0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHBhcnNlIDE2IChtaWdodCBiZSAnMTYnIHdpdGggZG90ICcxNi4nKVxuICAgICAgICAgICAgZWxzZSBpZiAoY2ggPT09ICcxJyAmJiBuZXh0KDEpID09PSAnNicpIHtcbiAgICAgICAgICAgICAgbGV0IGRvdHRlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICBpZiAodG9rZW5baSsyXSA9PT0gJy4nKSBkb3R0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICBub3Rlcy5wdXNoKHsgdmFsdWU6IDE2LCBkb3R0ZWQgfSk7XG4gICAgICAgICAgICAgIGkgKz0gMjtcbiAgICAgICAgICAgICAgaWYgKHRva2VuW2ldID09PSAnLicpIGkgKz0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIHBhcnNlIHNpbmdsZS1kaWdpdCB2YWx1ZXM6IDgsNCwyLDFcbiAgICAgICAgICAgIGVsc2UgaWYgKGNoID09PSAnOCcgfHwgY2ggPT09ICc0JyB8fCBjaCA9PT0gJzInIHx8IGNoID09PSAnMScpIHtcbiAgICAgICAgICAgICAgLy8gaGFuZGxlICcxJyBwb3NzaWJseSBwYXJ0IG9mICcxNicgYnV0IHdlIGFscmVhZHkgaGFuZGxlZCAnMTYnIGFib3ZlXG4gICAgICAgICAgICAgIGxldCBkb3R0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgaWYgKHRva2VuW2krMV0gPT09ICcuJykgZG90dGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgY29uc3QgdmFsID0gcGFyc2VJbnQoY2gsIDEwKTtcbiAgICAgICAgICAgICAgbm90ZXMucHVzaCh7IHZhbHVlOiB2YWwsIGRvdHRlZCB9KTtcbiAgICAgICAgICAgICAgaSArPSAxO1xuICAgICAgICAgICAgICBpZiAodG9rZW5baV0gPT09ICcuJykgaSArPSAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gc2tpcCB1bmV4cGVjdGVkIGNoYXJhY3RlcnNcbiAgICAgICAgICAgICAgaSArPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gLy8gZW5kIHBhcnNlIHRva2VuIGNoYXJzXG5cbiAgICAgICAgICBpZiAobm90ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgLy8gRWFjaCByaHl0aG0gdG9rZW4gYmVjb21lcyBhIEJlYXQuIEl0J3MgcG9zc2libGUgdG9rZW4gaW5jbHVkZWQgbXVsdGlwbGUgbm90ZXMuXG4gICAgICAgICAgICBiZWF0cy5wdXNoKHsgbm90ZXMgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IC8vIGVuZCByaHl0aG1Ub2tlbnMgbG9vcFxuICAgICAgICBcbiAgICAgICAgdG9rZW5zLnB1c2goeyB0eXBlOiAnY2hvcmQnLCBjaG9yZCwgYmVhdHMgfSk7XG4gICAgICAgIHJlbWFpbmluZyA9IHJlbWFpbmluZy5zdWJzdHJpbmcoY2hvcmRNYXRjaFswXS5sZW5ndGgpO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gU2tpcCB1bmtub3duIGNoYXJhY3RlcnNcbiAgICAgIHJlbWFpbmluZyA9IHJlbWFpbmluZy5zdWJzdHJpbmcoMSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiB0b2tlbnM7XG4gIH1cblxuICAvKipcbiAgICogUmVuZGVyIGNob3JkIGdyaWQgZnJvbSBzb3VyY2UgdGV4dCBpbnRvIGNvbnRhaW5lciBlbGVtZW50XG4gICAqL1xuICByZW5kZXJDaG9yZEdyaWQoc291cmNlOiBzdHJpbmcsIGNvbnRhaW5lcjogSFRNTEVsZW1lbnQpIHtcbiAgICBjb25zdCBncmlkID0gdGhpcy5wYXJzZUNob3JkR3JpZChzb3VyY2UpO1xuICAgIFxuICAgIGNvbnN0IHN2ZyA9IHRoaXMuY3JlYXRlU1ZHKGdyaWQpO1xuICAgIGNvbnRhaW5lci5lbXB0eSgpO1xuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdmcpO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBTVkcgZWxlbWVudCBmb3IgdGhlIGVudGlyZSBjaG9yZCBncmlkXG4gICAqL1xuICBjcmVhdGVTVkcoZ3JpZDogQ2hvcmRHcmlkKTogU1ZHRWxlbWVudCB7XG4gICAgY29uc3QgbWVhc3VyZXNQZXJMaW5lID0gNDtcbiAgICBjb25zdCBtZWFzdXJlV2lkdGggPSAyMDA7XG4gICAgY29uc3QgbWVhc3VyZUhlaWdodCA9IDEyMDtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgbGluZXMgY29uc2lkZXJpbmcgbGluZSBicmVha3NcbiAgICBsZXQgY3VycmVudExpbmUgPSAwO1xuICAgIGxldCBtZWFzdXJlc0luQ3VycmVudExpbmUgPSAwO1xuICAgIGNvbnN0IG1lYXN1cmVQb3NpdGlvbnM6IHttZWFzdXJlOiBNZWFzdXJlLCBsaW5lSW5kZXg6IG51bWJlciwgcG9zSW5MaW5lOiBudW1iZXJ9W10gPSBbXTtcbiAgICBcbiAgICBncmlkLm1lYXN1cmVzLmZvckVhY2goKG1lYXN1cmUsIGluZGV4KSA9PiB7XG4gICAgICBpZiAobWVhc3VyZS5pc0xpbmVCcmVhaykge1xuICAgICAgICBjdXJyZW50TGluZSsrO1xuICAgICAgICBtZWFzdXJlc0luQ3VycmVudExpbmUgPSAwO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChtZWFzdXJlc0luQ3VycmVudExpbmUgPj0gbWVhc3VyZXNQZXJMaW5lKSB7XG4gICAgICAgIGN1cnJlbnRMaW5lKys7XG4gICAgICAgIG1lYXN1cmVzSW5DdXJyZW50TGluZSA9IDA7XG4gICAgICB9XG4gICAgICBcbiAgICAgIG1lYXN1cmVQb3NpdGlvbnMucHVzaCh7XG4gICAgICAgIG1lYXN1cmUsXG4gICAgICAgIGxpbmVJbmRleDogY3VycmVudExpbmUsXG4gICAgICAgIHBvc0luTGluZTogbWVhc3VyZXNJbkN1cnJlbnRMaW5lXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgbWVhc3VyZXNJbkN1cnJlbnRMaW5lKys7XG4gICAgfSk7XG5cbiAgICBjb25zdCBsaW5lcyA9IGN1cnJlbnRMaW5lICsgMTtcbiAgICBjb25zdCB3aWR0aCA9IG1lYXN1cmVzUGVyTGluZSAqIG1lYXN1cmVXaWR0aCArIDYwO1xuICAgIGNvbnN0IGhlaWdodCA9IGxpbmVzICogKG1lYXN1cmVIZWlnaHQgKyAyMCkgKyAyMDtcblxuICAgIGNvbnN0IHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnc3ZnJyk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgnd2lkdGgnLCB3aWR0aC50b1N0cmluZygpKTtcbiAgICBzdmcuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCBoZWlnaHQudG9TdHJpbmcoKSk7XG4gICAgc3ZnLnNldEF0dHJpYnV0ZSgndmlld0JveCcsIGAwIDAgJHt3aWR0aH0gJHtoZWlnaHR9YCk7XG4gICAgc3ZnLnN0eWxlLmJhY2tncm91bmQgPSAnI2ZmZmZmZic7XG5cbiAgICAvLyBEcmF3IHRpbWUgc2lnbmF0dXJlIGF0IHRoZSBiZWdpbm5pbmdcbiAgICBjb25zdCB0aW1lU2lnVGV4dCA9IHRoaXMuY3JlYXRlVGV4dChncmlkLnRpbWVTaWduYXR1cmUsIDEwLCA0MCwgJzE4cHgnLCAnYm9sZCcpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZCh0aW1lU2lnVGV4dCk7XG5cbiAgICAvLyBEcmF3IGFsbCBtZWFzdXJlc1xuICAgIG1lYXN1cmVQb3NpdGlvbnMuZm9yRWFjaCgoe21lYXN1cmUsIGxpbmVJbmRleCwgcG9zSW5MaW5lfSkgPT4ge1xuICAgICAgY29uc3QgeCA9IHBvc0luTGluZSAqIG1lYXN1cmVXaWR0aCArIDQwO1xuICAgICAgY29uc3QgeSA9IGxpbmVJbmRleCAqIChtZWFzdXJlSGVpZ2h0ICsgMjApICsgMjA7XG5cbiAgICAgIHRoaXMuZHJhd01lYXN1cmUoc3ZnLCBtZWFzdXJlLCB4LCB5LCBtZWFzdXJlV2lkdGgsIG1lYXN1cmVIZWlnaHQpO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIHN2ZztcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IGEgc2luZ2xlIG1lYXN1cmUgd2l0aCBjaG9yZCwgcmh5dGhtLCBhbmQgYmFyIGxpbmVzXG4gICAqL1xuICBkcmF3TWVhc3VyZShzdmc6IFNWR0VsZW1lbnQsIG1lYXN1cmU6IE1lYXN1cmUsIHg6IG51bWJlciwgeTogbnVtYmVyLCB3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcikge1xuICAgIC8vIERyYXcgbGVmdCBiYXIgbGluZVxuICAgIGlmIChtZWFzdXJlLmlzUmVwZWF0U3RhcnQpIHtcbiAgICAgIHRoaXMuZHJhd1JlcGVhdEJhcihzdmcsIHgsIHksIGhlaWdodCwgdHJ1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZHJhd0JhcihzdmcsIHgsIHksIGhlaWdodCk7XG4gICAgfVxuXG4gICAgLy8gRHJhdyBzaW5nbGUgc3RhZmYgbGluZVxuICAgIGNvbnN0IHN0YWZmTGluZVkgPSB5ICsgODA7XG4gICAgY29uc3Qgc3RhZmZMaW5lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdsaW5lJyk7XG4gICAgc3RhZmZMaW5lLnNldEF0dHJpYnV0ZSgneDEnLCAoeCArIDEwKS50b1N0cmluZygpKTtcbiAgICBzdGFmZkxpbmUuc2V0QXR0cmlidXRlKCd5MScsIHN0YWZmTGluZVkudG9TdHJpbmcoKSk7XG4gICAgc3RhZmZMaW5lLnNldEF0dHJpYnV0ZSgneDInLCAoeCArIHdpZHRoIC0gMTApLnRvU3RyaW5nKCkpO1xuICAgIHN0YWZmTGluZS5zZXRBdHRyaWJ1dGUoJ3kyJywgc3RhZmZMaW5lWS50b1N0cmluZygpKTtcbiAgICBzdGFmZkxpbmUuc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnIzAwMCcpO1xuICAgIHN0YWZmTGluZS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICcxJyk7XG4gICAgc3ZnLmFwcGVuZENoaWxkKHN0YWZmTGluZSk7XG5cbiAgICAvLyBEcmF3IGFsbCBjaG9yZHMgaW4gdGhlIG1lYXN1cmVcbiAgICBjb25zdCBjaG9yZFdpZHRoID0gd2lkdGggLyBtZWFzdXJlLmNob3Jkcy5sZW5ndGg7XG4gICAgbWVhc3VyZS5jaG9yZHMuZm9yRWFjaCgoY2hvcmREYXRhLCBjaG9yZEluZGV4KSA9PiB7XG4gICAgICBjb25zdCBjaG9yZFggPSB4ICsgKGNob3JkSW5kZXggKiBjaG9yZFdpZHRoKSArIDEwO1xuICAgICAgXG4gICAgICAvLyBEcmF3IHJoeXRobSBub3RhdGlvbiBmb3IgdGhpcyBjaG9yZFxuICAgICAgY29uc3QgZmlyc3ROb3RlWCA9IHRoaXMuZHJhd1JoeXRobShzdmcsIGNob3JkRGF0YSwgY2hvcmRYLCBzdGFmZkxpbmVZLCBjaG9yZFdpZHRoIC0gMjApO1xuXG4gICAgICAvLyBEcmF3IGNob3JkIG5hbWUgYWJvdmUgdGhlIGZpcnN0IG5vdGVcbiAgICAgIGlmIChmaXJzdE5vdGVYICE9PSBudWxsKSB7XG4gICAgICAgIGNvbnN0IGNob3JkVGV4dCA9IHRoaXMuY3JlYXRlVGV4dChjaG9yZERhdGEuY2hvcmQsIGZpcnN0Tm90ZVgsIHkgKyA0MCwgJzI0cHgnLCAnYm9sZCcpO1xuICAgICAgICBjaG9yZFRleHQuc2V0QXR0cmlidXRlKCd0ZXh0LWFuY2hvcicsICdtaWRkbGUnKTtcbiAgICAgICAgc3ZnLmFwcGVuZENoaWxkKGNob3JkVGV4dCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBEcmF3IHJpZ2h0IGJhciBsaW5lIE9OTFkgaWYgaGFzQmFyTGluZSBpcyB0cnVlIG9yIGl0J3MgYSByZXBlYXQgZW5kXG4gICAgY29uc3QgcmlnaHRCYXJYID0geCArIHdpZHRoIC0gMjtcbiAgICBpZiAobWVhc3VyZS5oYXNCYXJMaW5lIHx8IG1lYXN1cmUuaXNSZXBlYXRFbmQpIHtcbiAgICAgIGlmIChtZWFzdXJlLmlzUmVwZWF0RW5kKSB7XG4gICAgICAgIHRoaXMuZHJhd1JlcGVhdEJhcihzdmcsIHJpZ2h0QmFyWCwgeSwgaGVpZ2h0LCBmYWxzZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmRyYXdCYXIoc3ZnLCByaWdodEJhclgsIHksIGhlaWdodCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERyYXcgYSBzaW1wbGUgYmFyIGxpbmVcbiAgICovXG4gIGRyYXdCYXIoc3ZnOiBTVkdFbGVtZW50LCB4OiBudW1iZXIsIHk6IG51bWJlciwgaGVpZ2h0OiBudW1iZXIpIHtcbiAgICBjb25zdCBsaW5lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdsaW5lJyk7XG4gICAgbGluZS5zZXRBdHRyaWJ1dGUoJ3gxJywgeC50b1N0cmluZygpKTtcbiAgICBsaW5lLnNldEF0dHJpYnV0ZSgneTEnLCB5LnRvU3RyaW5nKCkpO1xuICAgIGxpbmUuc2V0QXR0cmlidXRlKCd4MicsIHgudG9TdHJpbmcoKSk7XG4gICAgbGluZS5zZXRBdHRyaWJ1dGUoJ3kyJywgKHkgKyBoZWlnaHQpLnRvU3RyaW5nKCkpO1xuICAgIGxpbmUuc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnIzAwMCcpO1xuICAgIGxpbmUuc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnMicpO1xuICAgIHN2Zy5hcHBlbmRDaGlsZChsaW5lKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IHJlcGVhdCBiYXIgd2l0aCBkb3RzXG4gICAqL1xuICBkcmF3UmVwZWF0QmFyKHN2ZzogU1ZHRWxlbWVudCwgeDogbnVtYmVyLCB5OiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBpc1N0YXJ0OiBib29sZWFuKSB7XG4gICAgY29uc3Qgb2Zmc2V0ID0gaXNTdGFydCA/IDAgOiAtNjtcbiAgICBjb25zdCBiYXJYID0geCArIG9mZnNldDtcbiAgICB0aGlzLmRyYXdCYXIoc3ZnLCBiYXJYLCB5LCBoZWlnaHQpO1xuICAgIHRoaXMuZHJhd0JhcihzdmcsIGJhclggKyA0LCB5LCBoZWlnaHQpO1xuXG4gICAgY29uc3QgZG90T2Zmc2V0ID0gaXNTdGFydCA/IDEwIDogLTEwO1xuICAgIGNvbnN0IGRvdDFZID0geSArIGhlaWdodCAqIDAuMzU7XG4gICAgY29uc3QgZG90MlkgPSB5ICsgaGVpZ2h0ICogMC42NTtcblxuICAgIFtkb3QxWSwgZG90MlldLmZvckVhY2goZG90WSA9PiB7XG4gICAgICBjb25zdCBjaXJjbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ2NpcmNsZScpO1xuICAgICAgY2lyY2xlLnNldEF0dHJpYnV0ZSgnY3gnLCAoeCArIGRvdE9mZnNldCkudG9TdHJpbmcoKSk7XG4gICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKCdjeScsIGRvdFkudG9TdHJpbmcoKSk7XG4gICAgICBjaXJjbGUuc2V0QXR0cmlidXRlKCdyJywgJzMnKTtcbiAgICAgIGNpcmNsZS5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnIzAwMCcpO1xuICAgICAgc3ZnLmFwcGVuZENoaWxkKGNpcmNsZSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRHJhdyByaHl0aG0gcGF0dGVybiBmb3IgYSBjaG9yZCBhbmQgcmV0dXJuIHRoZSB4IHBvc2l0aW9uIG9mIHRoZSBmaXJzdCBub3RlXG4gICAqL1xuICBkcmF3Umh5dGhtKHN2ZzogU1ZHRWxlbWVudCwgY2hvcmREYXRhOiBDaG9yZEluTWVhc3VyZSwgeDogbnVtYmVyLCBzdGFmZkxpbmVZOiBudW1iZXIsIHdpZHRoOiBudW1iZXIpOiBudW1iZXIgfCBudWxsIHtcbiAgICBjb25zdCBiZWF0cyA9IGNob3JkRGF0YS5iZWF0cztcbiAgICBjb25zdCBiZWF0V2lkdGggPSBiZWF0cy5sZW5ndGggPiAwID8gd2lkdGggLyBiZWF0cy5sZW5ndGggOiB3aWR0aDtcbiAgICBsZXQgY3VycmVudFggPSB4O1xuICAgIGxldCBmaXJzdE5vdGVYOiBudW1iZXIgfCBudWxsID0gbnVsbDtcblxuICAgIGJlYXRzLmZvckVhY2goKGJlYXQsIGJlYXRJbmRleCkgPT4ge1xuICAgICAgY29uc3QgZmlyc3ROb3RlSW5CZWF0WCA9IHRoaXMuZHJhd0JlYXQoc3ZnLCBiZWF0LCBjdXJyZW50WCwgc3RhZmZMaW5lWSwgYmVhdFdpZHRoKTtcbiAgICAgIFxuICAgICAgaWYgKGJlYXRJbmRleCA9PT0gMCAmJiBmaXJzdE5vdGVJbkJlYXRYICE9PSBudWxsKSB7XG4gICAgICAgIGZpcnN0Tm90ZVggPSBmaXJzdE5vdGVJbkJlYXRYO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjdXJyZW50WCArPSBiZWF0V2lkdGg7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZmlyc3ROb3RlWDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IGEgc2luZ2xlIGJlYXQgLSBoYW5kbGVzIGJvdGggc2luZ2xlIG5vdGVzIGFuZCBiZWFtZWQgZ3JvdXBzXG4gICAqIFJldHVybnMgdGhlIHggcG9zaXRpb24gb2YgdGhlIGZpcnN0IG5vdGUgaW4gdGhpcyBiZWF0XG4gICAqL1xuICBkcmF3QmVhdChzdmc6IFNWR0VsZW1lbnQsIGJlYXQ6IEJlYXQsIHg6IG51bWJlciwgc3RhZmZMaW5lWTogbnVtYmVyLCB3aWR0aDogbnVtYmVyKTogbnVtYmVyIHwgbnVsbCB7XG4gICAgaWYgKGJlYXQubm90ZXMubGVuZ3RoID09PSAxKSB7XG4gICAgICAvLyBTaW5nbGUgbm90ZSBcdTIwMTQgcGFzcyB0aGUgYmVhdCBhbmQgdGhlIHNpbmdsZSBub3RlIHRvIGRyYXdTaW5nbGVOb3RlIHNvIGl0IGNhbiByZW5kZXIgZG90dGVkIHBlci1ub3RlXG4gICAgICBjb25zdCBudiA9IGJlYXQubm90ZXNbMF07XG4gICAgICByZXR1cm4gdGhpcy5kcmF3U2luZ2xlTm90ZShzdmcsIG52LCB4LCBzdGFmZkxpbmVZLCB3aWR0aCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIE11bHRpcGxlIG5vdGVzIC0gdXNlIHByb3BlciByaHl0aG1pYyBncm91cGluZyB3aXRoIGJlYW1zXG4gICAgICByZXR1cm4gdGhpcy5kcmF3Tm90ZUdyb3VwKHN2ZywgYmVhdC5ub3RlcywgeCwgc3RhZmZMaW5lWSwgd2lkdGgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IGEgc2luZ2xlIG5vdGUgd2l0aCBzbGFzaCBhbmQgc3RlbVxuICAgKi9cbiAgZHJhd1NpbmdsZU5vdGUoc3ZnOiBTVkdFbGVtZW50LCBudjogTm90ZVZhbHVlLCB4OiBudW1iZXIsIHN0YWZmTGluZVk6IG51bWJlciwgd2lkdGg6IG51bWJlcik6IG51bWJlciB7XG4gICAgY29uc3QgY2VudGVyWCA9IHggKyB3aWR0aCAvIDI7XG5cbiAgICAvLyBEcmF3IHNsYXNoICh0b3AtcmlnaHQgdG8gYm90dG9tLWxlZnQpXG4gICAgdGhpcy5kcmF3U2xhc2goc3ZnLCBjZW50ZXJYLCBzdGFmZkxpbmVZKTtcblxuICAgIC8vIERyYXcgc3RlbSBmb3Igc2hvcnQgbm90ZXMgLSBBVFRBQ0hFRCBUTyBCT1RUT00gT0YgU0xBU0hcbiAgICBpZiAobnYudmFsdWUgPj0gMiAmJiBudi52YWx1ZSAhPT0gMSkge1xuICAgICAgdGhpcy5kcmF3U3RlbShzdmcsIGNlbnRlclgsIHN0YWZmTGluZVksIDI1KTtcbiAgICB9XG5cbiAgICAvLyBEcmF3IGZsYWdzIGlmIG5lZWRlZCAoZm9yIHNpbmdsZSBpc29sYXRlZCBzaG9ydCBub3RlcylcbiAgICBpZiAobnYudmFsdWUgPT09IDgpIHtcbiAgICAgIHRoaXMuZHJhd0ZsYWcoc3ZnLCBjZW50ZXJYLCBzdGFmZkxpbmVZLCAxKTtcbiAgICB9IGVsc2UgaWYgKG52LnZhbHVlID09PSAxNikge1xuICAgICAgdGhpcy5kcmF3RmxhZyhzdmcsIGNlbnRlclgsIHN0YWZmTGluZVksIDIpO1xuICAgIH0gZWxzZSBpZiAobnYudmFsdWUgPT09IDMyKSB7XG4gICAgICB0aGlzLmRyYXdGbGFnKHN2ZywgY2VudGVyWCwgc3RhZmZMaW5lWSwgMyk7XG4gICAgfVxuXG4gICAgLy8gSWYgdGhpcyBub3RlIGlzIGRvdHRlZCwgZHJhdyBhIHNtYWxsIGRvdCB0byB0aGUgcmlnaHQgb2YgdGhlIG5vdGUgaGVhZFxuICAgIGlmIChudi5kb3R0ZWQpIHtcbiAgICAgIGNvbnN0IGRvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnY2lyY2xlJyk7XG4gICAgICAvLyBwb3NpdGlvbiBzbGlnaHRseSByaWdodCBhbmQgdmVydGljYWxseSBhbGlnbmVkIHRvIHN0YWZmTGluZVlcbiAgICAgIGRvdC5zZXRBdHRyaWJ1dGUoJ2N4JywgKGNlbnRlclggKyA4KS50b1N0cmluZygpKTtcbiAgICAgIGRvdC5zZXRBdHRyaWJ1dGUoJ2N5JywgKHN0YWZmTGluZVkpLnRvU3RyaW5nKCkpO1xuICAgICAgZG90LnNldEF0dHJpYnV0ZSgncicsICcyJyk7XG4gICAgICBkb3Quc2V0QXR0cmlidXRlKCdmaWxsJywgJyMwMDAnKTtcbiAgICAgIHN2Zy5hcHBlbmRDaGlsZChkb3QpO1xuICAgIH1cblxuICAgIHJldHVybiBjZW50ZXJYO1xuICB9XG5cbiAgLyoqXG4gICAqIERyYXcgYSBncm91cCBvZiBub3RlcyB3aXRoIHByb3BlciBiZWFtaW5nLCBpbmNsdWRpbmcgbmVzdGVkIGJlYW0gc2VnbWVudHMgZm9yIG1peGVkIGR1cmF0aW9uc1xuICAgKiBub3Rlc1ZhbHVlczogYXJyYXkgb2YgTm90ZVZhbHVlIG9iamVjdHMgKGUuZy4sIFt7dmFsdWU6OH0se3ZhbHVlOjE2fV0pXG4gICAqXG4gICAqIEJlaGF2aW9yOlxuICAgKiAtIENvbXB1dGUgYmVhbUNvdW50IHBlciBub3RlICg4LT4xLDE2LT4yLDMyLT4zKS5cbiAgICogLSBEcmF3IHN0ZW0gZm9yIGVhY2ggbm90ZSBhbmQgc3RvcmUgc3RlbSBwb3NpdGlvbnMuXG4gICAqIC0gRm9yIGVhY2ggYmVhbSBsZXZlbCwgZHJhdyBjb250aW51b3VzIGJlYW1zIHdoZXJlIG5vdGVzIGhhdmUgYmVhbUNvdW50ID49IGxldmVsLlxuICAgKiAtIEZvciBub3RlcyB0aGF0IGhhdmUgZXh0cmEgYmVhbXMgKGxldmVsID4gbmVpZ2hib3IncyBsZXZlbCksIGRyYXcgYSBzaG9ydCBzdHViIGV4dGVuZGluZyBsZWZ0IGZyb20gdGhhdCBzdGVtLlxuICAgKiAtIERyYXcgcGVyLW5vdGUgZG90dGVkIHBvaW50cyBuZXh0IHRvIGhlYWRzLlxuICAgKi9cbiAgZHJhd05vdGVHcm91cChzdmc6IFNWR0VsZW1lbnQsIG5vdGVzVmFsdWVzOiBOb3RlVmFsdWVbXSwgeDogbnVtYmVyLCBzdGFmZkxpbmVZOiBudW1iZXIsIHdpZHRoOiBudW1iZXIpOiBudW1iZXIge1xuICAgIGNvbnN0IG5vdGVDb3VudCA9IG5vdGVzVmFsdWVzLmxlbmd0aDtcbiAgICBjb25zdCBub3RlU3BhY2luZyA9IG5vdGVDb3VudCA+IDAgPyB3aWR0aCAvIG5vdGVDb3VudCA6IHdpZHRoO1xuICAgIGNvbnN0IHN0ZW1IZWlnaHQgPSAyNTtcblxuICAgIC8vIE1hcCBub3RlcyB0byB0aGVpciBkcmF3aW5nIGluZm9cbiAgICBjb25zdCBub3RlczogeyBudjogTm90ZVZhbHVlOyBiZWFtQ291bnQ6IG51bWJlcjsgY2VudGVyWDogbnVtYmVyOyBzdGVtWD86IG51bWJlcjsgc3RlbVRvcFk/OiBudW1iZXI7IHN0ZW1Cb3R0b21ZPzogbnVtYmVyIH1bXSA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub3RlQ291bnQ7IGkrKykge1xuICAgICAgY29uc3QgbnYgPSBub3Rlc1ZhbHVlc1tpXTtcbiAgICAgIGNvbnN0IGNlbnRlclggPSB4ICsgaSAqIG5vdGVTcGFjaW5nICsgbm90ZVNwYWNpbmcgLyAyO1xuICAgICAgY29uc3QgYmVhbUNvdW50ID0gbnYudmFsdWUgPT09IDggPyAxIDogbnYudmFsdWUgPT09IDE2ID8gMiA6IG52LnZhbHVlID09PSAzMiA/IDMgOiAwO1xuXG4gICAgICAvLyBEcmF3IHNsYXNoIGZvciBlYWNoIG5vdGVcbiAgICAgIHRoaXMuZHJhd1NsYXNoKHN2ZywgY2VudGVyWCwgc3RhZmZMaW5lWSk7XG5cbiAgICAgIC8vIERyYXcgc3RlbSBhbmQgc3RvcmUgcG9zaXRpb25zXG4gICAgICBjb25zdCBzdGVtSW5mbyA9IHRoaXMuZHJhd1N0ZW0oc3ZnLCBjZW50ZXJYLCBzdGFmZkxpbmVZLCBzdGVtSGVpZ2h0KTtcbiAgICAgIG5vdGVzLnB1c2goeyBudiwgYmVhbUNvdW50LCBjZW50ZXJYLCBzdGVtWDogc3RlbUluZm8ueCwgc3RlbVRvcFk6IHN0ZW1JbmZvLnRvcFksIHN0ZW1Cb3R0b21ZOiBzdGVtSW5mby5ib3R0b21ZIH0pO1xuXG4gICAgICAvLyBEcmF3IHBlci1ub3RlIGRvdCBuZWFyIGhlYWQgaWYgZG90dGVkXG4gICAgICBpZiAobnYuZG90dGVkKSB7XG4gICAgICAgIGNvbnN0IGRvdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnY2lyY2xlJyk7XG4gICAgICAgIGRvdC5zZXRBdHRyaWJ1dGUoJ2N4JywgKGNlbnRlclggKyA4KS50b1N0cmluZygpKTtcbiAgICAgICAgZG90LnNldEF0dHJpYnV0ZSgnY3knLCAoc3RhZmZMaW5lWSkudG9TdHJpbmcoKSk7XG4gICAgICAgIGRvdC5zZXRBdHRyaWJ1dGUoJ3InLCAnMicpO1xuICAgICAgICBkb3Quc2V0QXR0cmlidXRlKCdmaWxsJywgJyMwMDAnKTtcbiAgICAgICAgc3ZnLmFwcGVuZENoaWxkKGRvdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRGV0ZXJtaW5lIG1heGltdW0gYmVhbSBjb3VudCBpbiB0aGlzIGdyb3VwXG4gICAgY29uc3QgbWF4QmVhbUNvdW50ID0gbm90ZXMucmVkdWNlKChtLCBuKSA9PiBNYXRoLm1heChtLCBuLmJlYW1Db3VudCksIDApO1xuICAgIGlmIChtYXhCZWFtQ291bnQgPT09IDApIHJldHVybiBub3Rlcy5sZW5ndGggPyBub3Rlc1swXS5jZW50ZXJYIDogbnVsbDtcblxuICAgIC8vIGJlYW1HYXAgY29udHJvbHMgdmVydGljYWwgZ2FwIGJldHdlZW4gc3RhY2tlZCBiZWFtc1xuICAgIGNvbnN0IGJlYW1HYXAgPSA1O1xuXG4gICAgLy8gYmFzZVN0ZW1Cb3R0b20gaXMgdGhlIHRvcC1tb3N0IChtaW4pIHN0ZW0gYm90dG9tIFkgc28gYmVhbXMgc2l0IG9uIHRvcCBvZiBzdGVtc1xuICAgIC8vIEZpbHRlciBvdXQgdW5kZWZpbmVkIHZhbHVlcyBiZWZvcmUgY29tcHV0aW5nIG1pblxuICAgIGNvbnN0IHZhbGlkU3RlbUJvdHRvbXMgPSBub3Rlcy5tYXAobiA9PiBuLnN0ZW1Cb3R0b21ZKS5maWx0ZXIoeSA9PiB5ICE9PSB1bmRlZmluZWQpIGFzIG51bWJlcltdO1xuICAgIGNvbnN0IGJhc2VTdGVtQm90dG9tID0gdmFsaWRTdGVtQm90dG9tcy5sZW5ndGggPiAwID8gTWF0aC5taW4oLi4udmFsaWRTdGVtQm90dG9tcykgOiBzdGFmZkxpbmVZICsgMzA7XG5cbiAgICAvLyBGb3IgZWFjaCBiZWFtIGxldmVsLCBkcmF3IGNvbnRpbnVvdXMgYmVhbXMgYW5kIHN0dWJzIGZvciBpc29sYXRlZCBoaWdoZXIgYmVhbXNcbiAgICBmb3IgKGxldCBsZXZlbCA9IDE7IGxldmVsIDw9IG1heEJlYW1Db3VudDsgbGV2ZWwrKykge1xuICAgICAgbGV0IHNlZ1N0YXJ0SW5kZXg6IG51bWJlciB8IG51bGwgPSBudWxsO1xuXG4gICAgICAvLyBGaXJzdCBwYXNzOiBkcmF3IGNvbnRpbnVvdXMgYmVhbSBzZWdtZW50c1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub3Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBuID0gbm90ZXNbaV07XG4gICAgICAgIGNvbnN0IGFjdGl2ZSA9IG4uYmVhbUNvdW50ID49IGxldmVsO1xuXG4gICAgICAgIC8vIGxvb2sgYXQgbmVpZ2hib3JzIHRvIGZpbmQgY29udGludW91cyBzZWdtZW50c1xuICAgICAgICBpZiAoYWN0aXZlICYmIHNlZ1N0YXJ0SW5kZXggPT09IG51bGwpIHtcbiAgICAgICAgICAvLyBzdGFydCBuZXcgc2VnbWVudFxuICAgICAgICAgIHNlZ1N0YXJ0SW5kZXggPSBpO1xuICAgICAgICB9IGVsc2UgaWYgKCghYWN0aXZlIHx8IGkgPT09IG5vdGVzLmxlbmd0aCAtIDEpICYmIHNlZ1N0YXJ0SW5kZXggIT09IG51bGwpIHtcbiAgICAgICAgICAvLyBjbG9zaW5nIHNlZ21lbnQ6IGlmIHdlJ3JlIGF0IGVuZCBidXQgYWN0aXZlLCBzZWdFbmQgc2hvdWxkIGJlIGk7IG90aGVyd2lzZSBpLTFcbiAgICAgICAgICBjb25zdCBzZWdFbmQgPSAoYWN0aXZlICYmIGkgPT09IG5vdGVzLmxlbmd0aCAtIDEpID8gaSA6IGkgLSAxO1xuXG4gICAgICAgICAgLy8gY29tcHV0ZSBiZWFtIFk6IHN0YXJ0IGZyb20gYmFzZVN0ZW1Cb3R0b20gYW5kIGdvIHVwIGZvciBoaWdoZXIgbGV2ZWxzXG4gICAgICAgICAgY29uc3QgYmVhbVkgPSBiYXNlU3RlbUJvdHRvbSAtIChsZXZlbCAtIDEpICogYmVhbUdhcDtcblxuICAgICAgICAgIC8vIGRyYXcgY29udGludW91cyBiZWFtIGZyb20gc2VnU3RhcnRJbmRleCB0byBzZWdFbmRcbiAgICAgICAgICBjb25zdCBzdGFydFggPSBub3Rlc1tzZWdTdGFydEluZGV4XS5zdGVtWCE7XG4gICAgICAgICAgY29uc3QgZW5kWCA9IG5vdGVzW3NlZ0VuZF0uc3RlbVghO1xuICAgICAgICAgIGNvbnN0IGJlYW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ2xpbmUnKTtcbiAgICAgICAgICBiZWFtLnNldEF0dHJpYnV0ZSgneDEnLCBzdGFydFgudG9TdHJpbmcoKSk7XG4gICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3kxJywgYmVhbVkudG9TdHJpbmcoKSk7XG4gICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3gyJywgZW5kWC50b1N0cmluZygpKTtcbiAgICAgICAgICBiZWFtLnNldEF0dHJpYnV0ZSgneTInLCBiZWFtWS50b1N0cmluZygpKTtcbiAgICAgICAgICBiZWFtLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJyMwMDAnKTtcbiAgICAgICAgICBiZWFtLnNldEF0dHJpYnV0ZSgnc3Ryb2tlLXdpZHRoJywgJzInKTtcbiAgICAgICAgICBzdmcuYXBwZW5kQ2hpbGQoYmVhbSk7XG5cbiAgICAgICAgICBzZWdTdGFydEluZGV4ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBTZWNvbmQgcGFzczogZHJhdyBzdHVicyBmb3IgaXNvbGF0ZWQgbm90ZXMgYXQgaGlnaGVyIGJlYW0gbGV2ZWxzXG4gICAgICAvLyBBIHN0dWIgc2hvdWxkIHBvaW50IGluIHRoZSBkaXJlY3Rpb24gb2YgdGhlIGJlYW1lZCBncm91cCAoaWYgYW55IGV4aXN0cylcbiAgICAgIC8vIFJVTEU6IEZpcnN0IG5vdGUgb2YgZ3JvdXAgY2Fubm90IGhhdmUgbGVmdCBzdHViLCBsYXN0IG5vdGUgY2Fubm90IGhhdmUgcmlnaHQgc3R1YlxuICAgICAgY29uc3Qgc3R1Ykxlbmd0aCA9IE1hdGgubWF4KDgsIG5vdGVTcGFjaW5nICogMC40KTtcbiAgICAgIFxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub3Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBuID0gbm90ZXNbaV07XG4gICAgICAgIGNvbnN0IGhhc0xldmVsID0gbi5iZWFtQ291bnQgPj0gbGV2ZWw7XG4gICAgICAgIFxuICAgICAgICBpZiAoIWhhc0xldmVsKSBjb250aW51ZTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGxlZnRCZWFtQ291bnQgPSAoaSAtIDEgPj0gMCkgPyBub3Rlc1tpIC0gMV0uYmVhbUNvdW50IDogMDtcbiAgICAgICAgY29uc3QgcmlnaHRCZWFtQ291bnQgPSAoaSArIDEgPCBub3Rlcy5sZW5ndGgpID8gbm90ZXNbaSArIDFdLmJlYW1Db3VudCA6IDA7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBsZWZ0SGFzTGV2ZWwgPSBsZWZ0QmVhbUNvdW50ID49IGxldmVsO1xuICAgICAgICBjb25zdCByaWdodEhhc0xldmVsID0gcmlnaHRCZWFtQ291bnQgPj0gbGV2ZWw7XG4gICAgICAgIFxuICAgICAgICAvLyBTa2lwIGlmIGJvdGggbmVpZ2hib3JzIGhhdmUgdGhpcyBsZXZlbCAoY29udGludW91cyBiZWFtIGNvdmVycyBpdClcbiAgICAgICAgaWYgKGxlZnRIYXNMZXZlbCAmJiByaWdodEhhc0xldmVsKSBjb250aW51ZTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNraXAgaWYgbmVpdGhlciBuZWlnaGJvciBoYXMgdGhpcyBsZXZlbCBBTkQgdGhpcyBpcyBhbiBpc29sYXRlZCBub3RlIHdpdGggbm8gYmVhbSBhdCBhbGxcbiAgICAgICAgaWYgKCFsZWZ0SGFzTGV2ZWwgJiYgIXJpZ2h0SGFzTGV2ZWwpIHtcbiAgICAgICAgICAvLyBUaGlzIG5vdGUgaXMgaXNvbGF0ZWQgYXQgdGhpcyBsZXZlbFxuICAgICAgICAgIC8vIERyYXcgc3R1YiB0byB0aGUgcmlnaHQgT05MWSBpZiBub3QgdGhlIGxhc3Qgbm90ZSBvZiB0aGUgZW50aXJlIGdyb3VwXG4gICAgICAgICAgaWYgKGkgPCBub3Rlcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICBjb25zdCBiZWFtWSA9IGJhc2VTdGVtQm90dG9tIC0gKGxldmVsIC0gMSkgKiBiZWFtR2FwO1xuICAgICAgICAgICAgY29uc3Qgc3RlbVggPSBuLnN0ZW1YITtcbiAgICAgICAgICAgIGNvbnN0IHN0dWJYID0gc3RlbVggKyBzdHViTGVuZ3RoO1xuICAgICAgICAgICAgY29uc3QgYmVhbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnbGluZScpO1xuICAgICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3gxJywgc3RlbVgudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICBiZWFtLnNldEF0dHJpYnV0ZSgneTEnLCBiZWFtWS50b1N0cmluZygpKTtcbiAgICAgICAgICAgIGJlYW0uc2V0QXR0cmlidXRlKCd4MicsIHN0dWJYLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3kyJywgYmVhbVkudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICBiZWFtLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJyMwMDAnKTtcbiAgICAgICAgICAgIGJlYW0uc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnMicpO1xuICAgICAgICAgICAgc3ZnLmFwcGVuZENoaWxkKGJlYW0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBJZiB0aGlzIElTIHRoZSBsYXN0IG5vdGUsIGRyYXcgc3R1YiB0byB0aGUgTEVGVCBpbnN0ZWFkXG4gICAgICAgICAgZWxzZSBpZiAoaSA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGJlYW1ZID0gYmFzZVN0ZW1Cb3R0b20gLSAobGV2ZWwgLSAxKSAqIGJlYW1HYXA7XG4gICAgICAgICAgICBjb25zdCBzdGVtWCA9IG4uc3RlbVghO1xuICAgICAgICAgICAgY29uc3Qgc3R1YlggPSBzdGVtWCAtIHN0dWJMZW5ndGg7XG4gICAgICAgICAgICBjb25zdCBiZWFtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdsaW5lJyk7XG4gICAgICAgICAgICBiZWFtLnNldEF0dHJpYnV0ZSgneDEnLCBzdGVtWC50b1N0cmluZygpKTtcbiAgICAgICAgICAgIGJlYW0uc2V0QXR0cmlidXRlKCd5MScsIGJlYW1ZLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3gyJywgc3R1YlgudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICBiZWFtLnNldEF0dHJpYnV0ZSgneTInLCBiZWFtWS50b1N0cmluZygpKTtcbiAgICAgICAgICAgIGJlYW0uc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnIzAwMCcpO1xuICAgICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICcyJyk7XG4gICAgICAgICAgICBzdmcuYXBwZW5kQ2hpbGQoYmVhbSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBiZWFtWSA9IGJhc2VTdGVtQm90dG9tIC0gKGxldmVsIC0gMSkgKiBiZWFtR2FwO1xuICAgICAgICBjb25zdCBzdGVtWCA9IG4uc3RlbVghO1xuICAgICAgICBcbiAgICAgICAgLy8gSWYgb25seSBsZWZ0IGhhcyBsZXZlbDogc3R1YiB0byB0aGUgTEVGVCAocGFydCBvZiBncm91cCBvbiB0aGUgbGVmdClcbiAgICAgICAgLy8gQlVUIG9ubHkgaWYgbm90IHRoZSBmaXJzdCBub3RlIG9mIHRoZSBncm91cFxuICAgICAgICBpZiAobGVmdEhhc0xldmVsICYmICFyaWdodEhhc0xldmVsICYmIGkgPiAwKSB7XG4gICAgICAgICAgY29uc3Qgc3R1YlggPSBzdGVtWCAtIHN0dWJMZW5ndGg7XG4gICAgICAgICAgY29uc3QgYmVhbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnbGluZScpO1xuICAgICAgICAgIGJlYW0uc2V0QXR0cmlidXRlKCd4MScsIHN0ZW1YLnRvU3RyaW5nKCkpO1xuICAgICAgICAgIGJlYW0uc2V0QXR0cmlidXRlKCd5MScsIGJlYW1ZLnRvU3RyaW5nKCkpO1xuICAgICAgICAgIGJlYW0uc2V0QXR0cmlidXRlKCd4MicsIHN0dWJYLnRvU3RyaW5nKCkpO1xuICAgICAgICAgIGJlYW0uc2V0QXR0cmlidXRlKCd5MicsIGJlYW1ZLnRvU3RyaW5nKCkpO1xuICAgICAgICAgIGJlYW0uc2V0QXR0cmlidXRlKCdzdHJva2UnLCAnIzAwMCcpO1xuICAgICAgICAgIGJlYW0uc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnMicpO1xuICAgICAgICAgIHN2Zy5hcHBlbmRDaGlsZChiZWFtKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gSWYgb25seSByaWdodCBoYXMgbGV2ZWw6IHN0dWIgdG8gdGhlIFJJR0hUIChwYXJ0IG9mIGdyb3VwIG9uIHRoZSByaWdodClcbiAgICAgICAgLy8gQlVUIG9ubHkgaWYgbm90IHRoZSBsYXN0IG5vdGUgb2YgdGhlIGdyb3VwXG4gICAgICAgIGlmICghbGVmdEhhc0xldmVsICYmIHJpZ2h0SGFzTGV2ZWwgJiYgaSA8IG5vdGVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICBjb25zdCBzdHViWCA9IHN0ZW1YICsgc3R1Ykxlbmd0aDtcbiAgICAgICAgICBjb25zdCBiZWFtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudE5TKCdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZycsICdsaW5lJyk7XG4gICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3gxJywgc3RlbVgudG9TdHJpbmcoKSk7XG4gICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3kxJywgYmVhbVkudG9TdHJpbmcoKSk7XG4gICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3gyJywgc3R1YlgudG9TdHJpbmcoKSk7XG4gICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3kyJywgYmVhbVkudG9TdHJpbmcoKSk7XG4gICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICcjMDAwJyk7XG4gICAgICAgICAgYmVhbS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICcyJyk7XG4gICAgICAgICAgc3ZnLmFwcGVuZENoaWxkKGJlYW0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG5vdGVzLmxlbmd0aCA/IG5vdGVzWzBdLmNlbnRlclggOiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIERyYXcgYSBzbGFzaCBhdCA0NVx1MDBCMCBhbmdsZSAodG9wLVJJR0hUIHRvIGJvdHRvbS1MRUZUIC0gcHJvcGVyIHNsYXNoIGRpcmVjdGlvbilcbiAgICogd2l0aCBzdGVtIGF0dGFjaGVkIHRvIHRoZSBib3R0b21cbiAgICovXG4gIGRyYXdTbGFzaChzdmc6IFNWR0VsZW1lbnQsIHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgY29uc3Qgc2xhc2hMZW5ndGggPSAxMDtcbiAgICAvLyA0NVx1MDBCMCBzbGFzaCBmcm9tIHRvcC1SSUdIVCB0byBib3R0b20tTEVGVCAocHJvcGVyIHNsYXNoIGRpcmVjdGlvbilcbiAgICBjb25zdCBzbGFzaCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnbGluZScpO1xuICAgIHNsYXNoLnNldEF0dHJpYnV0ZSgneDEnLCAoeCArIHNsYXNoTGVuZ3RoLzIpLnRvU3RyaW5nKCkpO1xuICAgIHNsYXNoLnNldEF0dHJpYnV0ZSgneTEnLCAoeSAtIHNsYXNoTGVuZ3RoLzIpLnRvU3RyaW5nKCkpO1xuICAgIHNsYXNoLnNldEF0dHJpYnV0ZSgneDInLCAoeCAtIHNsYXNoTGVuZ3RoLzIpLnRvU3RyaW5nKCkpO1xuICAgIHNsYXNoLnNldEF0dHJpYnV0ZSgneTInLCAoeSArIHNsYXNoTGVuZ3RoLzIpLnRvU3RyaW5nKCkpO1xuICAgIHNsYXNoLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJyMwMDAnKTtcbiAgICBzbGFzaC5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICczJyk7XG4gICAgc3ZnLmFwcGVuZENoaWxkKHNsYXNoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEcmF3IGEgc3RlbSBmb3IgYSBub3RlIC0gQVRUQUNIRUQgVE8gQk9UVE9NIE9GIFNMQVNIXG4gICAqIFJldHVybnMgdGhlIFggcG9zaXRpb24gb2YgdGhlIHN0ZW0gYW5kIHRoZSBib3R0b20gWSBmb3IgcHJvcGVyIGJlYW0gYWxpZ25tZW50XG4gICAqL1xuICBkcmF3U3RlbShzdmc6IFNWR0VsZW1lbnQsIHg6IG51bWJlciwgeTogbnVtYmVyLCBoZWlnaHQ6IG51bWJlcik6IHt4OiBudW1iZXIsIHRvcFk6IG51bWJlciwgYm90dG9tWTogbnVtYmVyfSB7XG4gICAgLy8gQ2FsY3VsYXRlIHRoZSBib3R0b20gcG9pbnQgb2YgdGhlIHNsYXNoICh3aGVyZSBzdGVtIHNob3VsZCBhdHRhY2gpXG4gICAgY29uc3Qgc2xhc2hMZW5ndGggPSAxMDtcbiAgICBjb25zdCBzdGVtU3RhcnRYID0geCAtIHNsYXNoTGVuZ3RoLzIgKyAyOyAvLyBCb3R0b20tbGVmdCBvZiBzbGFzaCArIG9mZnNldFxuICAgIGNvbnN0IHN0ZW1TdGFydFkgPSB5ICsgc2xhc2hMZW5ndGgvMjsgICAgIC8vIEJvdHRvbSBvZiBzbGFzaFxuICAgIFxuICAgIGNvbnN0IHN0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ2xpbmUnKTtcbiAgICBzdGVtLnNldEF0dHJpYnV0ZSgneDEnLCBzdGVtU3RhcnRYLnRvU3RyaW5nKCkpO1xuICAgIHN0ZW0uc2V0QXR0cmlidXRlKCd5MScsIHN0ZW1TdGFydFkudG9TdHJpbmcoKSk7XG4gICAgc3RlbS5zZXRBdHRyaWJ1dGUoJ3gyJywgc3RlbVN0YXJ0WC50b1N0cmluZygpKTtcbiAgICBzdGVtLnNldEF0dHJpYnV0ZSgneTInLCAoc3RlbVN0YXJ0WSArIGhlaWdodCkudG9TdHJpbmcoKSk7XG4gICAgc3RlbS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZScsICcjMDAwJyk7XG4gICAgc3RlbS5zZXRBdHRyaWJ1dGUoJ3N0cm9rZS13aWR0aCcsICcyJyk7XG4gICAgc3ZnLmFwcGVuZENoaWxkKHN0ZW0pO1xuXG4gICAgcmV0dXJuIHsgeDogc3RlbVN0YXJ0WCwgdG9wWTogc3RlbVN0YXJ0WSwgYm90dG9tWTogc3RlbVN0YXJ0WSArIGhlaWdodCB9O1xuICB9XG5cbiAgLyoqXG4gICAqIERyYXcgZmxhZyhzKSBmb3IgYSBub3RlIChmb3IgaXNvbGF0ZWQgc2hvcnQgbm90ZXMpXG4gICAqL1xuICBkcmF3RmxhZyhzdmc6IFNWR0VsZW1lbnQsIHg6IG51bWJlciwgc3RhZmZMaW5lWTogbnVtYmVyLCBjb3VudDogbnVtYmVyKSB7XG4gICAgY29uc3Qgc2xhc2hMZW5ndGggPSAxMDtcbiAgICBjb25zdCBzdGVtU3RhcnRYID0geCAtIHNsYXNoTGVuZ3RoLzIgKyAyO1xuICAgIGNvbnN0IHN0ZW1Cb3R0b21ZID0gc3RhZmZMaW5lWSArIHNsYXNoTGVuZ3RoLzIgKyAyNTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykge1xuICAgICAgY29uc3QgZmxhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAncGF0aCcpO1xuICAgICAgY29uc3QgZmxhZ1kgPSBzdGVtQm90dG9tWSAtIGkgKiAxMDtcbiAgICAgIFxuICAgICAgZmxhZy5zZXRBdHRyaWJ1dGUoJ2QnLCBgTSAke3N0ZW1TdGFydFh9ICR7ZmxhZ1l9IFEgJHtzdGVtU3RhcnRYIC0gMTB9ICR7ZmxhZ1kgLSA1fSAke3N0ZW1TdGFydFggLSA4fSAke2ZsYWdZIC0gMTJ9YCk7XG4gICAgICBmbGFnLnNldEF0dHJpYnV0ZSgnc3Ryb2tlJywgJyMwMDAnKTtcbiAgICAgIGZsYWcuc2V0QXR0cmlidXRlKCdzdHJva2Utd2lkdGgnLCAnMicpO1xuICAgICAgZmxhZy5zZXRBdHRyaWJ1dGUoJ2ZpbGwnLCAnbm9uZScpO1xuICAgICAgc3ZnLmFwcGVuZENoaWxkKGZsYWcpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBVdGlsaXR5IGZ1bmN0aW9uIHRvIGNyZWF0ZSB0ZXh0IGVsZW1lbnRzXG4gICAqL1xuICBjcmVhdGVUZXh0KHRleHQ6IHN0cmluZywgeDogbnVtYmVyLCB5OiBudW1iZXIsIHNpemU6IHN0cmluZywgd2VpZ2h0OiBzdHJpbmcgPSAnbm9ybWFsJyk6IFNWR1RleHRFbGVtZW50IHtcbiAgICBjb25zdCB0ZXh0RWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3RleHQnKTtcbiAgICB0ZXh0RWwuc2V0QXR0cmlidXRlKCd4JywgeC50b1N0cmluZygpKTtcbiAgICB0ZXh0RWwuc2V0QXR0cmlidXRlKCd5JywgeS50b1N0cmluZygpKTtcbiAgICB0ZXh0RWwuc2V0QXR0cmlidXRlKCdmb250LWZhbWlseScsICdBcmlhbCwgc2Fucy1zZXJpZicpO1xuICAgIHRleHRFbC5zZXRBdHRyaWJ1dGUoJ2ZvbnQtc2l6ZScsIHNpemUpO1xuICAgIHRleHRFbC5zZXRBdHRyaWJ1dGUoJ2ZvbnQtd2VpZ2h0Jywgd2VpZ2h0KTtcbiAgICB0ZXh0RWwuc2V0QXR0cmlidXRlKCdmaWxsJywgJyMwMDAnKTtcbiAgICB0ZXh0RWwudGV4dENvbnRlbnQgPSB0ZXh0O1xuICAgIHJldHVybiB0ZXh0RWw7XG4gIH1cblxuICBvbnVubG9hZCgpIHtcbiAgICBjb25zb2xlLmxvZygnVW5sb2FkaW5nIENob3JkIEdyaWQgcGx1Z2luJyk7XG4gIH1cbn0iXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsc0JBQXFEO0FBOEJyRCxJQUFxQixrQkFBckIsY0FBNkMsdUJBQU87QUFBQSxFQUNsRCxNQUFNLFNBQVM7QUFDYixZQUFRLElBQUksMkJBQTJCO0FBR3ZDLFNB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QUFXLFNBQVMsQ0FBQztBQUM3QyxTQUFLLGFBQWEsTUFBTSxXQUFXLFNBQVMsQ0FBQztBQUM3QyxTQUFLLGFBQWEsT0FBTyxhQUFhLFFBQVEsU0FBUyxDQUFDO0FBQ3hELFNBQUssYUFBYSxVQUFVLE1BQU07QUFDbEMsU0FBSyxhQUFhLGdCQUFnQixHQUFHO0FBQ3JDLFFBQUksWUFBWSxJQUFJO0FBRXBCLFdBQU8sRUFBRSxHQUFHLFlBQVksTUFBTSxZQUFZLFNBQVMsYUFBYSxPQUFPO0FBQUEsRUFDekU7QUFBQTtBQUFBO0FBQUE7QUFBQSxFQUtBLFNBQVMsS0FBaUIsR0FBVyxZQUFvQixPQUFlO0FBQ3RFLFVBQU0sY0FBYztBQUNwQixVQUFNLGFBQWEsSUFBSSxjQUFZLElBQUk7QUFDdkMsVUFBTSxjQUFjLGFBQWEsY0FBWSxJQUFJO0FBRWpELGFBQVMsSUFBSSxHQUFHLElBQUksT0FBTyxLQUFLO0FBQzlCLFlBQU0sT0FBTyxTQUFTLGdCQUFnQiw4QkFBOEIsTUFBTTtBQUMxRSxZQUFNLFFBQVEsY0FBYyxJQUFJO0FBRWhDLFdBQUssYUFBYSxLQUFLLEtBQUssVUFBVSxJQUFJLEtBQUssTUFBTSxhQUFhLEVBQUUsSUFBSSxRQUFRLENBQUMsSUFBSSxhQUFhLENBQUMsSUFBSSxRQUFRLEVBQUUsRUFBRTtBQUNuSCxXQUFLLGFBQWEsVUFBVSxNQUFNO0FBQ2xDLFdBQUssYUFBYSxnQkFBZ0IsR0FBRztBQUNyQyxXQUFLLGFBQWEsUUFBUSxNQUFNO0FBQ2hDLFVBQUksWUFBWSxJQUFJO0FBQUEsSUFDdEI7QUFBQSxFQUNGO0FBQUE7QUFBQTtBQUFBO0FBQUEsRUFLQSxXQUFXLE1BQWMsR0FBVyxHQUFXLE1BQWMsU0FBaUIsVUFBMEI7QUFDdEcsVUFBTSxTQUFTLFNBQVMsZ0JBQWdCLDhCQUE4QixNQUFNO0FBQzVFLFdBQU8sYUFBYSxLQUFLLEVBQUUsU0FBUyxDQUFDO0FBQ3JDLFdBQU8sYUFBYSxLQUFLLEVBQUUsU0FBUyxDQUFDO0FBQ3JDLFdBQU8sYUFBYSxlQUFlLG1CQUFtQjtBQUN0RCxXQUFPLGFBQWEsYUFBYSxJQUFJO0FBQ3JDLFdBQU8sYUFBYSxlQUFlLE1BQU07QUFDekMsV0FBTyxhQUFhLFFBQVEsTUFBTTtBQUNsQyxXQUFPLGNBQWM7QUFDckIsV0FBTztBQUFBLEVBQ1Q7QUFBQSxFQUVBLFdBQVc7QUFDVCxZQUFRLElBQUksNkJBQTZCO0FBQUEsRUFDM0M7QUFDRjsiLAogICJuYW1lcyI6IFsiYmVhbVkiLCAic3RlbVgiXQp9Cg==
